#these triggers check if the player can meet with the character in the given scenes. they are used in the character interaction, and in the travel arrival event.
#triggers for the mutltiple characters conversations

# Add code block 10 below this comment
# Code block 10 example
## Meet in "sence_name"
#can_meet_in_"sence_name" = {
#	AND = {
#		scope:actor.location = scope:recipient.location
#		scope:actor = {is_imprisoned = no}
#		scope:recipient = {is_imprisoned = no}
#		scope:actor.location = { has_building = "building_name" }.
#	}
#}

# Meet in the Chinese market
can_meet_in_market_east = {
	AND = {
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		scope:actor.location.culture = { has_coa_gfx = chinese_group_coa_gfx }
		or = {
			scope:actor.location = { has_building_or_higher = castle_01 }
			scope:actor.location = { has_building_or_higher = city_01 }
			scope:actor.location = { has_building_or_higher = temple_01 }
		}
	}
}

# Meet in the market
can_meet_in_market = {
	AND = {
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		not = {
			scope:actor.location.culture = { has_coa_gfx = chinese_group_coa_gfx }
		}
		or = {
			scope:actor.location = { has_building_or_higher = castle_01 }
			scope:actor.location = { has_building_or_higher = city_01 }
			scope:actor.location = { has_building_or_higher = temple_01 }
		}
	}
}

# Meet in the tavern
can_meet_in_tavern = {
	AND = {
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		not = {
			scope:actor.location.culture = { has_coa_gfx = chinese_group_coa_gfx }
		}
		or = {
			scope:actor.location = { has_building_or_higher = castle_01 }
			scope:actor.location = { has_building_or_higher = city_01 }
			scope:actor.location = { has_building_or_higher = temple_01 }
		}
	}
}

# Meet in tavern_east
can_meet_in_tavern_east = {
	AND = {
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		scope:actor.location.culture = { has_coa_gfx = chinese_group_coa_gfx }
		or = {
			scope:actor.location = { has_building_or_higher = castle_01 }
			scope:actor.location = { has_building_or_higher = city_01 }
			scope:actor.location = { has_building_or_higher = temple_01 }
		}
	}
}

# Meet in the Iron Throne
can_meet_in_iron_throne = {
	AND = {
		scope:actor.location = scope:recipient.location
		or = {
			scope:actor = {
				is_imprisoned = no
				has_title = title:e_the_iron_throne
				}
			scope:recipient = {
				is_imprisoned = no
				has_title = title:e_the_iron_throne
				}
			}
		}
}

# Meet in Lingyin Temple
can_meet_in_lingyinsi = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		scope:actor.location = { has_building = lingyin_temple_01 }
	}
}

# Meet in the Japanese Imperial Palace
can_meet_in_throneroom_japan = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		scope:actor.location = { has_building = heian_palace_01 }
	}
}

# Meet in Shaolin Temple
can_meet_in_shaolinsi = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		scope:actor.location = { has_building = shaolin_monastery_01 }
	}
}

# Meet in Wudang Mountain Taoist Temple
can_meet_in_wudangshandaoguan = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		scope:actor.location = { has_building = wudang_mountain_temples_01 }
	}
}

# Meet in Leshan Giant Buddha
can_meet_in_leshandafou = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		scope:actor.location = { has_building = leshan_giant_buddha_01 }
	}
}

# Meet in Mount Tai
can_meet_in_taishan = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		scope:actor.location = { has_building = mount_tai_01 }
	}
}

# Meet in Wulingyuan
can_meet_in_wulingyuan = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		scope:actor.location = { has_building = wulingyuan_01 }
	}
}

# Meet in Kaifeng Imperial City
can_meet_in_kaifenghuangcheng = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		scope:actor.location = { has_building = kaifeng_palace_01 }
	}
}

# Meet in Tengwang Pavilion
can_meet_in_tengwangge = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		#scope:actor.location.culture = { has_coa_gfx = chinese_group_coa_gfx }
		OR = {
			scope:actor.location = { has_building = tengwangge }
			scope:actor.location = { has_building = prince_teng_pavilion_01 }
		}
	}
}

# Meet in Yueyang Tower
can_meet_in_yueyanglou = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		#scope:actor.location.culture = { has_coa_gfx = chinese_group_coa_gfx }
		OR = {
			scope:actor.location = { has_building = yueyanglou_1 }
			scope:actor.location = { has_building = yueyanglou_2 }
			}
	}
}

# Meet in Yellow Crane Tower
can_meet_in_huanghelou = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		#scope:actor.location.culture = { has_coa_gfx = chinese_group_coa_gfx }
		scope:actor.location = { has_building = huanghelou }
	}
}

# Meet in the harem
can_meet_in_harem = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = { is_imprisoned = no }
		scope:recipient = { is_imprisoned = no }
		scope:secondary_recipient ?= { is_imprisoned = no }
		scope:actor.culture = {
			NOT = { has_coa_gfx = chinese_group_coa_gfx }
		}
		OR = {
			scope:actor = { has_court_position = str_slave_concubine_court_position }
			scope:recipient = { has_court_position = str_slave_concubine_court_position }
			scope:secondary_recipient ?= { has_court_position = str_slave_concubine_court_position }
			scope:actor = { is_concubine_of = scope:recipient }
			scope:recipient = { is_concubine_of = scope:actor }
			scope:secondary_recipient ?= { is_concubine_of = scope:actor }
		}
	}
}

# Meet in Yungang Grottoes
can_meet_in_yungangshiku = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		#scope:actor.location.culture = { has_coa_gfx = chinese_group_coa_gfx }
		scope:actor.location = { has_building = yungang_grottoes_01 }
	}
}

# Meet in the bedroom
can_meet_in_bedchamber_east1 = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		scope:actor.culture = { has_coa_gfx = chinese_group_coa_gfx }
		OR = {
			scope:actor = {primary_partner = scope:recipient}
			scope:recipient = {primary_partner = scope:actor}
			scope:recipient = {is_concubine_of = scope:actor}
		}
	}
}

# Meet in the Imperial Garden
can_meet_in_garden_east1 = {
	AND = {
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
		OR = {
				AND = {
					scope:recipient = {highest_held_title_tier >= tier_empire}
					scope:recipient.culture = { has_coa_gfx = chinese_group_coa_gfx }	
					scope:recipient = scope:actor.location.province_owner
				
			}
				AND = {
					scope:actor = {highest_held_title_tier >= tier_empire}
					scope:actor.culture = { has_coa_gfx = chinese_group_coa_gfx }
					scope:actor = scope:actor.location.province_owner

			}
				AND = {
					scope:actor.location.province_owner.culture = { has_coa_gfx = chinese_group_coa_gfx }
					scope:actor.location.province_owner = {highest_held_title_tier >= tier_empire}
					scope:recipient = {is_courtier_of = scope:actor.location.province_owner}


			}

		}
		}		
	}


# Audience in the government office
can_meet_in_throneroom_east_fuya1 = {
	AND = {
		scope:actor = scope:actor.location.province_owner
		scope:actor = {highest_held_title_tier >= tier_county}
		scope:actor = {highest_held_title_tier <= tier_duchy}
		scope:actor.culture = { has_coa_gfx = chinese_group_coa_gfx }
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
	}
	}

# Meet in the government office
can_meet_in_throneroom_east_fuya = {
	AND = {
		OR = {
			scope:recipient = {is_courtier_of = scope:actor.location.province_owner}
			scope:recipient = scope:actor.location.province_owner
		}
		scope:actor = {is_landless_ruler = no}
		scope:recipient = {highest_held_title_tier >= tier_county}
		scope:recipient = {highest_held_title_tier <= tier_duchy}
		scope:recipient.culture = { has_coa_gfx = chinese_group_coa_gfx }
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
	}
	}


# Audience in the Imperial Palace
can_meet_in_throneroom_east_empire = {
	AND = {
		OR = {
			scope:actor = {is_landless_ruler = no}
			OR = {
				scope:recipient = {is_courtier_of = scope:actor.location.province_owner}
				scope:recipient = scope:actor.location.province_owner
			}
			
		}
		scope:recipient = {highest_held_title_tier >= tier_empire}
		scope:recipient.culture = { has_coa_gfx = chinese_group_coa_gfx }
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
	}
	}

# Summoned to the Imperial Palace	
can_meet_in_throneroom_east_empire1 = {
	AND = {
		OR = {
			scope:actor = {is_landless_ruler = no}
			OR = {
				scope:recipient = {is_courtier_of = scope:actor.location.province_owner}
				scope:recipient = scope:actor.location.province_owner
			}
			
		}
		scope:actor = {highest_held_title_tier >= tier_empire}
		scope:actor.culture = { has_coa_gfx = chinese_group_coa_gfx }
		scope:actor.location = scope:recipient.location
		scope:actor = {is_imprisoned = no}
		scope:recipient = {is_imprisoned = no}
	}
	}


can_meet_in_throneroom = {
	AND = {
		OR = {
			scope:actor = {is_landless_ruler = no}
			OR = {
				scope:recipient = { is_courtier_of = scope:actor.location.province_owner }
				scope:recipient = scope:actor.location.province_owner						
			}
			OR = {
				scope:secondary_recipient ?= { is_courtier_of = scope:actor.location.province_owner }											
				scope:secondary_recipient ?= scope:actor.location.province_owner					
			}			
		}
				# Modify
		scope:actor.culture = {
					NOT = { has_coa_gfx = chinese_group_coa_gfx }
				}
		scope:recipient.culture = {
					NOT = { has_coa_gfx = chinese_group_coa_gfx }
				}
		#########################
		scope:actor.location = scope:recipient.location		
#		scope:recipient.location = scope:secondary_recipient.location			
		scope:actor = { is_imprisoned = no }
		scope:recipient = { is_imprisoned = no }
		scope:secondary_recipient ?= { is_imprisoned = no }
		
	}
}

can_meet_in_garden = {
	AND = {
		OR = {
			scope:actor = { is_landless_ruler = no }
			OR = {
				scope:recipient = { is_courtier_of = scope:actor.location.province_owner }
				scope:recipient = scope:actor.location.province_owner						
			}
			OR = {
				scope:secondary_recipient ?= { is_courtier_of = scope:actor.location.province_owner }											
				scope:secondary_recipient ?= scope:actor.location.province_owner					
			}			
		}	
		scope:actor.location = scope:recipient.location			
		scope:actor = { is_imprisoned = no }
		scope:recipient = { is_imprisoned = no }
		scope:secondary_recipient ?= { is_imprisoned = no }
				
	}
}

can_meet_in_bedchamber = {		
			scope:actor.location = scope:recipient.location
			
			scope:actor = { is_imprisoned = no }
			scope:recipient = { is_imprisoned = no }	
			scope:secondary_recipient ?= { is_imprisoned = no }
			OR = {
				is_close_family_of = scope:actor
				scope:recipient = {
							OR = {
								has_court_position = str_slave_concubine_court_position 
								is_consort_of = scope:actor
							}
				}
				scope:secondary_recipient ?= {
							OR = {
								has_court_position = str_slave_concubine_court_position 
								is_consort_of = scope:actor
							}
				}
				scope:actor = {
						OR = {
							is_consort_of = scope:recipient
							has_relation_slave_owner = scope:recipient
							has_relation_lover = scope:recipient
							is_consort_of = scope:secondary_recipient
							has_relation_slave_owner = scope:secondary_recipient
							has_relation_lover = scope:secondary_recipient

							
						}	
				}
			}	
}



can_meet_in_dungeon = {
	AND = {
		scope:actor.location = scope:recipient.location					
		OR = {
			scope:actor = { is_imprisoned = yes }
			scope:recipient = { is_imprisoned = yes }
			scope:secondary_recipient ?= { is_imprisoned = yes }
		}
			
	}
}

#not how to do it correctly but whatever
can_meet_in_feast = {
	AND = {
		scope:actor.location = scope:recipient.location					
		scope:actor = {
			involved_activity ?= { has_activity_type = activity_feast }
			location ?= involved_activity.activity_location
		}
		scope:recipient = {
				involved_activity ?= { has_activity_type = activity_feast }
				location ?= involved_activity.activity_location
		}
		scope:secondary_recipient ?= {
				involved_activity ?= { has_activity_type = activity_feast }
				location ?= involved_activity.activity_location
		}					
	}
}

can_meet_in_armycamp = {	
	AND = {	

		scope:actor.location = scope:recipient.location
		OR = {
			scope:actor = {
					is_in_army = yes
			}
			scope:recipient = {
					is_in_army = yes
			}
			scope:actor = {	
					is_landless_ruler = yes
			}
			scope:secondary_recipient ?= {
					is_in_army = yes
			}
		}	
	
	}
}

can_meet_in_hunt = {
	AND = {
	
		scope:actor.location = scope:recipient.location				
		scope:actor = {
			involved_activity ?= { has_activity_type = activity_hunt }
			location ?= involved_activity.activity_location
		}
		scope:recipient = {
				involved_activity ?= { has_activity_type = activity_hunt }
				location ?= involved_activity.activity_location
		}
		scope:secondary_recipient ?= {
				involved_activity ?= { has_activity_type = activity_hunt }
				location ?= involved_activity.activity_location
		}
	}	
	
}

can_meet_in_alley = {
	AND = {	
		scope:actor.location = scope:recipient.location		
		scope:actor = { is_imprisoned = no }
		scope:recipient = { is_imprisoned = no }
		scope:secondary_recipient ?= { is_imprisoned = no }
			
	}
}

